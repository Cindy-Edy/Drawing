<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mewarnai Gambar Keyza</title>
    <style>
        body {
            text-align: center;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            font-family: 'Poppins', sans-serif;
            transition: background 0.5s ease-in-out;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50, #4ca1af);
            color: white;
        }

        h1 {
            color: #fff;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        .toolbar {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            background: rgba(255, 255, 255, 0.3);
            padding: 10px;
            border-radius: 10px;
            gap: 10px;
        }

        canvas {
            width: 90vw;
            /* Lebih besar dari sebelumnya */
            height: 70vh;
            /* Menyesuaikan dengan tinggi layar */
            border: 5px solid #555;
            background: white;
            border-radius: 15px;
            cursor: crosshair;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3);
            max-width: 100%;
        }

        .button {
            padding: 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: 0.3s;
            position: relative;
        }

        .eraser {
            background: #ff9800;
            color: white;
        }

        .save,
        .upload {
            background: #673AB7;
            color: white;
        }

        .undo,
        .redo,
        .reset,
        .zoom-in,
        .zoom-out {
            background: #2196F3;
            color: white;
        }

        .grid-toggle {
            background: #4CAF50;
            color: white;
        }

        .button:hover {
            opacity: 0.8;
        }

        #imagePicker {
            margin: 10px;
            font-size: 16px;
        }

        /* Tooltip styles */
        .button[title] {
            position: relative;
        }

        .button[title]:hover::after {
            content: attr(title);
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px;
            border-radius: 5px;
            font-size: 14px;
            white-space: nowrap;
        }

        .dark-mode-toggle {
            background: #333;
            color: white;
        }
        
    </style>
</head>

<body>
    <h1>Mewarnai Gambar untuk Keyzia</h1>
    <div class="toolbar">
        <input type="color" id="colorPicker" title="Pilih Warna">
        <input type="range" id="penSize" min="2" max="20" value="5" title="Pilih Ukuran Kuas">
        <select id="brushPicker" title="Pilih Bentuk Kuas">
            <option value="">ğŸ¨ pilih kuas</option>
            <option value="round">ğŸ”µ Kuas Bulat</option>
            <option value="star">ğŸŒŸ Kuas Bintang</option>
            <option value="spray">ğŸ’¨ Kuas Semprot</option>
            <option value="square">â¬› Kuas Kotak</option>
        </select>
        <button class="button" id="darkModeToggle" title="Mode Gelap">ğŸŒ™</button>
        <button class="button eraser" onclick="activateEraser()" title="Aktifkan Penghapus">âœï¸ Penghapus</button>
        <button class="button undo" onclick="undo()" title="Undo">â†©ï¸ Undo</button>
        <button class="button redo" onclick="redo()" title="Redo">â†ªï¸ Redo</button>
        <button class="button reset" onclick="resetCanvas()" title="Reset Kanvas">ğŸ—‘ï¸ Reset</button>
        <button class="button zoom-in" onclick="zoomCanvas(1.2)" title="Zoom In">ğŸ”â• Zoom In</button>
        <button class="button zoom-out" onclick="zoomCanvas(0.8)" title="Zoom Out">ğŸ”â– Zoom Out</button>
        <button class="button grid-toggle" onclick="toggleGrid()" title="Tampilkan Grid">ğŸ“ Tampilkan Grid</button>
        <button class="button save" onclick="saveImage()" title="Simpan Gambar">ğŸ’¾ Simpan</button>
        <button class="button upload" onclick="shareToWhatsApp()" title="Bagikan ke WhatsApp"> ğŸ“¤ Bagikan ke
            WhatsApp</button>
        <input type="file" id="imagePicker" accept="image/*" onchange="loadImageFromFile(event)" title="Pilih Gambar">
    </div>
    <canvas id="drawingCanvas"></canvas>

    <script>
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false, erasing = false;
        let color = document.getElementById('colorPicker').value;
        let penSize = document.getElementById('penSize').value;
        let brushShape = document.getElementById('brushPicker').value;
        let history = [], redoStack = [], scale = 1, showGrid = false;
        let imageLoaded = false, imageData = null;
        let gridColor = '#ccc', gridSpacing = 50;

        function saveState() { history.push(canvas.toDataURL()); redoStack = []; }
        function undo() { if (history.length) loadImage(history.pop(), true); }
        function redo() { if (redoStack.length) loadImage(redoStack.pop(), true); }

        function activateEraser() {
            erasing = !erasing;
            ctx.globalCompositeOperation = erasing ? 'destination-out' : 'source-over';
            document.querySelector('.eraser').style.background = erasing ? "#FF5722" : "#FF9800";
        }

        function draw(e) {
            if (!drawing) return;

            let x = e.offsetX || (e.touches ? e.touches[0].clientX - canvas.offsetLeft : 0);
            let y = e.offsetY || (e.touches ? e.touches[0].clientY - canvas.offsetTop : 0);

            ctx.lineWidth = penSize;
            ctx.strokeStyle = erasing ? "rgba(0,0,0,1)" : color;
            ctx.lineCap = "round";

            if (brushShape === "star") drawStar(x, y);
            else if (brushShape === "spray") drawSpray(x, y);
            else if (brushShape === "square") drawSquare(x, y);
            else {
                ctx.lineTo(x, y);
                ctx.stroke();
            }
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function undo() {
            if (history.length > 0) {
                redoStack.push(history.pop());
                if (history.length > 0) loadImage(history[history.length - 1], true);
            }
        }

        function redo() {
            if (redoStack.length > 0) {
                let lastRedo = redoStack.pop();
                history.push(lastRedo);
                loadImage(lastRedo, true);
            }
        }

        function saveImage() {
            let link = document.createElement('a');
            link.download = 'gambar.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
        }

        function resizeCanvas() {
            let tempImage = new Image();
            tempImage.src = canvas.toDataURL();
            tempImage.onload = () => {
                canvas.width = window.innerWidth * 0.9;
                canvas.height = window.innerHeight * 0.7;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(tempImage, 0, 0, canvas.width, canvas.height);
                if (showGrid) drawGrid();
            };
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth * 0.9;
            canvas.height = window.innerHeight * 0.7;
            if (imageLoaded) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(imageData, 0, 0, canvas.width, canvas.height);
            }
        }


        function drawStar(x, y) {
            ctx.beginPath();
            ctx.moveTo(x, y);
            for (let i = 0; i < 5; i++) {
                ctx.lineTo(x + Math.cos((18 + i * 72) / 180 * Math.PI) * 10, y - Math.sin((18 + i * 72) / 180 * Math.PI) * 10);
                ctx.lineTo(x + Math.cos((54 + i * 72) / 180 * Math.PI) * 20, y - Math.sin((54 + i * 72) / 180 * Math.PI) * 20);
            }
            ctx.closePath();
            ctx.fillStyle = color;
            ctx.fill();
        }

        function drawSpray(x, y) {
            let count = 30;
            for (let i = 0; i < count; i++) {
                let angle = Math.random() * 2 * Math.PI;
                let radius = Math.random() * 5;
                ctx.fillStyle = color;
                ctx.fillRect(x + Math.cos(angle) * radius, y + Math.sin(angle) * radius, 2, 2);
            }
        }

        function drawSquare(x, y) { ctx.fillStyle = color; ctx.fillRect(x - 5, y - 5, 10, 10); }

        function resetCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); saveState(); }
        function zoomCanvas(factor) { scale *= factor; canvas.style.transform = `scale(${scale})`; }
        function toggleGrid() { showGrid = !showGrid; drawGrid(); }
        function drawGrid() {
            if (showGrid) {
                ctx.strokeStyle = gridColor;
                ctx.lineWidth = 0.5;
                for (let i = 0; i < canvas.width; i += gridSpacing) {
                    ctx.moveTo(i, 0);
                    ctx.lineTo(i, canvas.height);
                }
                for (let i = 0; i < canvas.height; i += gridSpacing) {
                    ctx.moveTo(0, i);
                    ctx.lineTo(canvas.width, i);
                }
                ctx.stroke();
            }
        }

        function saveImage() {
            let link = document.createElement('a');
            link.download = 'gambar.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        function shareToWhatsApp() {
            let imgData = canvas.toDataURL('image/png');
            let link = `https://wa.me/?text=Check%20this%20out!%20${encodeURIComponent(imgData)}`;
            window.open(link, '_blank');
        }

        function loadImageFromFile(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.onload = function () {
                    imageLoaded = true;
                    imageData = img;
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    saveState();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function loadImage(dataURL, isUndo) {
            const img = new Image();
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                if (!isUndo) saveState();
            };
            img.src = dataURL;
        }

        window.addEventListener('load', resizeCanvas);
        window.addEventListener('resize', resizeCanvas);


        canvas.addEventListener('mousedown', (e) => { saveState(); drawing = true; ctx.beginPath(); draw(e); });
        canvas.addEventListener('mouseup', () => { drawing = false; ctx.beginPath(); });
        canvas.addEventListener('mousemove', draw);
        document.getElementById('colorPicker').addEventListener('input', (e) => { color = e.target.value; });
        document.getElementById('penSize').addEventListener('input', (e) => { penSize = e.target.value; });
        document.getElementById('brushPicker').addEventListener('change', (e) => { brushShape = e.target.value; });

        canvas.addEventListener('mousedown', (e) => {
            saveState();
            drawing = true;
            ctx.beginPath();
            draw(e);
        });

        canvas.addEventListener('mouseup', () => {
            drawing = false;
            ctx.beginPath();
        });

        canvas.addEventListener('mousemove', draw);

        function getTouchPos(canvas, touchEvent) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: touchEvent.touches[0].clientX - rect.left,
                y: touchEvent.touches[0].clientY - rect.top
            };
        }

        canvas.addEventListener("touchstart", (e) => {
            e.preventDefault();
            saveState();
            drawing = true;
            let touchPos = getTouchPos(canvas, e);
            ctx.beginPath();
            ctx.moveTo(touchPos.x, touchPos.y);
        });

        canvas.addEventListener("touchmove", (e) => {
            e.preventDefault();
            if (!drawing) return;
            let touchPos = getTouchPos(canvas, e);
            ctx.lineTo(touchPos.x, touchPos.y);
            ctx.stroke();
        });

        canvas.addEventListener("touchend", () => {
            drawing = false;
            ctx.beginPath();
        });

        document.getElementById('darkModeToggle').addEventListener('click', () => {
            document.body.classList.toggle("dark-mode");
        });


    </script>
</body>

</html>
